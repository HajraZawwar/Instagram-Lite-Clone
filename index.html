<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Lite - Feed</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom Styles */
        .post-image {
            transition: transform 0.3s ease-in-out;
        }
        .post-image:hover {
            transform: scale(1.05);
        }
        .like-button:hover {
            color: red;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md py-4">
        <div class="container mx-auto flex items-center justify-between">
            <a href="#" class="text-2xl font-semibold text-gray-800">
                <i class="fab fa-instagram text-purple-500 mr-2"></i> Instagram Lite
            </a>
            <div class="flex items-center space-x-4">
                <button id="uploadButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    <i class="fas fa-upload mr-2"></i> Upload
                </button>
                <!-- Profile Icon (replace with actual profile link) -->
                <a href="#" class="text-gray-600 hover:text-gray-800">
                    <i class="fas fa-user-circle text-2xl"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Upload Form Modal -->
    <div id="uploadModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                        Create a New Post
                    </h3>
                    <div class="mt-2">
                        <input type="text" id="caption" placeholder="Write a caption..." class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-2">
                        <input type="url" id="mediaUrl" placeholder="Enter image URL" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-2">
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button id="postButton" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Post
                    </button>
                    <button id="cancelButton" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto py-8">
        <div id="feed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Posts will be loaded here -->
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 py-4 text-center text-gray-500">
        <p>&copy; 2025 Instagram Lite</p>
    </footer>

    <script>
        // JavaScript Functions
        const uploadButton = document.getElementById('uploadButton');
        const uploadModal = document.getElementById('uploadModal');
        const cancelButton = document.getElementById('cancelButton');
        const postButton = document.getElementById('postButton');
        const feed = document.getElementById('feed');

        uploadButton.addEventListener('click', () => {
            uploadModal.classList.remove('hidden');
        });

        cancelButton.addEventListener('click', () => {
            uploadModal.classList.add('hidden');
        });

        async function uploadPost() {
            const caption = document.getElementById('caption').value;
            const media_url = document.getElementById('mediaUrl').value;
            const user_id = localStorage.getItem('userId');

            const response = await fetch('http://127.0.0.1:5000/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id, caption, media_url })
            });

            const result = await response.json();
            alert(result.message);
            uploadModal.classList.add('hidden'); // Close the modal
            loadFeed();
        }

        postButton.addEventListener('click', uploadPost);

        async function loadFeed() {
            const response = await fetch('http://127.0.0.1:5000/feed');
            const posts = await response.json();
            feed.innerHTML = '';

            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                postElement.innerHTML = `
                    <img src="${post.media_url}" alt="Post Image" class="w-full h-64 object-cover post-image">
                    <div class="p-4">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-gray-800 font-semibold">${post.caption}</p>
                            <button class="like-button text-gray-600 hover:text-red-500 focus:outline-none">
                                <i class="fas fa-heart"></i> <span>${post.likes}</span>
                            </button>
                        </div>
                        <p class="text-gray-500 text-sm">${new Date(post.created_at).toLocaleString()}</p>
                    </div>
                `;
                feed.appendChild(postElement);
            });
        }

        loadFeed();
    </script>

</body>
</html>